(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[56],{58362:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/agent",function(){return n(25300)}])},66186:function(e,t,n){"use strict";n.d(t,{m:function(){return FeatureButton}});var s=n(85893);n(67294);var r=n(41664),a=n.n(r);function FeatureButton(e){let{url:t,message:n}=e;return(0,s.jsx)(a(),{href:t,rel:"noreferrer",target:"_blank",children:(0,s.jsxs)("button",{type:"button",className:"btn btn-no-border btn-sm mb-0 mt-1 px-0 py-2 ms-n2 lift",children:[(0,s.jsx)("i",{className:"fe fe-navigation m-2"})," ".concat(n," ")]})})}},25300:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSP:function(){return Z},default:function(){return L}});var s=n(85893),r=n(64487),a=n(41664),l=n.n(a),o=n(11163),i=n(33299),c=n(67294),d=n(66261),u=n(76812),h=n(9008),p=n.n(h),m=n(92981),g=n(12023),f=n(7895),b=n(97910),x=n(14258),w=n(45138),j=n(81829),v=n(79659),k=n(75617),y=n(9862);function isWhitespace(e){return" \r\n	".indexOf(e)>=0}var N=n(38323),C=n(82010),S=n(30399),T=n(11319),A=n(29758),P=n(635);let I={strict:!1,output:"mathml"};function FootnoteLink(e){let{href:t="",children:n,...r}=e,{theme:a,setTheme:l,resolvedTheme:o}=(0,C.F)(),i="#555",c="#d6d6d6";if("object"==typeof n&&null!==n&&Array.isArray(n)&&n.length>0){let e=n[0];if(Number.isInteger(Number(e))||Number.isInteger(Number(e.substring(1,e.length-1))))return(0,s.jsx)("sup",{children:(0,s.jsx)("a",{href:t,target:"_blank",className:"me-1",rel:"noopener noreferrer",style:"dark"===o?{display:"inline-block",borderRadius:"50%",backgroundColor:"#555",color:"#fff",width:"15px",height:"15px",textAlign:"center",textDecoration:"none",lineHeight:"15px",fontSize:"0.80em",fontWeight:"bold"}:{display:"inline-block",borderRadius:"50%",backgroundColor:"#d6d6d6",color:"#333",width:"15px",height:"15px",textAlign:"center",textDecoration:"none",lineHeight:"15px",fontSize:"0.80em",fontWeight:"bold"},onMouseOver:e=>{let t="#888";return e.currentTarget.style.backgroundColor=t,t},onMouseOut:e=>{let t="dark"===o?i:c;return e.currentTarget.style.backgroundColor=t,t},onFocus:e=>{let t="#888";return e.currentTarget.style.backgroundColor=t,t},onBlur:e=>{let t="dark"===o?i:c;return e.currentTarget.style.backgroundColor=t,t},children:Number(e)+1})})}return(0,s.jsx)("a",{href:t,...r,children:n})}let R=(0,c.memo)(function(e){let{markdown:t}=e,{theme:n,setTheme:r,resolvedTheme:a}=(0,C.F)(),l={backgroundColor:j.L5,padding:"3px",borderRadius:"8px",color:"white",cursor:"pointer"},o={backgroundColor:"white",padding:"3px",borderRadius:"8px",color:"black",cursor:"pointer"};return(0,s.jsx)(N.D,{remarkPlugins:[S.Z,A.Z],rehypePlugins:[T.Z,[T.Z,I]],className:"fs-5",components:{p:e=>{let{node:t,...n}=e;return(0,s.jsx)("p",{className:"text-black mb-2 text-break",...n})},ul:e=>{let{node:t,...n}=e,r={...n,ordered:"false"};return(0,s.jsx)("ul",{className:"mb-3",...r})},ol:e=>{let{node:t,...n}=e,r={...n,ordered:"true"};return(0,s.jsx)("ol",{className:"mb-2",...r})},a:FootnoteLink,code(e){let{node:t,inline:n,className:r,children:i,style:c,...d}=e;return n?(0,s.jsx)("code",{onClick:()=>{navigator.clipboard.writeText(String(i))},className:r,style:"dark"===a?o:l,...d,children:i}):(0,s.jsx)(P.Z,{highlighterProps:d,url:"",className:r,children:String(i)})}},children:t})});function AnswerMarkdown(e){let{answerText:t,question:n,webResults:r,citedWebResults:a,setCitedWebResults:l}=e;return(0,s.jsx)("div",{children:((e,t,n,r)=>{if(!e)return null;let a=null==n?void 0:n.map(e=>e.url),o=e;if(a&&(o=(0,k.Yg)(o,a)),n&&r){let e=[];for(let t=0;t<n.length;t+=1)o.includes("[".concat(t,"]"))&&n&&e.push(n[t]);let t=/\[([^\]]+)\]\(([^\)]+)\)/g,s=[],a=t.exec(o);for(;null!==a;)s.push({title:a[1],url:a[2]}),a=t.exec(o);s=s.filter((e,t,n)=>n.findIndex(t=>t.url===e.url)===t);for(let t=0;t<s.length;t+=1){let r=s[t];if(r&&n)for(let t=0;t<n.length;t+=1){let{url:s}=r;if(n[t]&&n[t].url===s){let r=!0;for(let t=0;t<e.length;t+=1)e[t].url===s&&(r=!1);r&&e.push(n[t])}}}let i=!0;for(let t=0;t<n.length;t+=1)r.length>0&&r.length===e.length&&(i=!1),0===e.length&&(i=!1);o=o.replace(/(\[\d+\])+/g,(t,s)=>{if(e.length>0){var r;let t=parseInt(s.replace(/\D/g,""),10),a=null===(r=n[t])||void 0===r?void 0:r.url,l=e.findIndex(e=>e.url===a);return"[".concat(l,"]")}return t}),i&&n&&n.length>0&&(0,c.useEffect)(()=>{l(t=>[...e])},[e]),o=o.replace(k.V7,(t,s)=>{if(n){var a;let t=null===(a=n[s])||void 0===a?void 0:a.url,l=null==e?void 0:e.findIndex(e=>e.url===t);return-1===l&&(l=r.length),"".concat(l)}return""})}return o.split("```").map((e,t)=>t%2!=0?(0,s.jsx)(R,{markdown:"```".concat(e,"```")},t):e.trimStart().split("\n\n").map((e,t)=>(0,s.jsx)(R,{markdown:e},e)))})(t,0,r,a)})}AnswerMarkdown.defaultProps={webResults:[],citedWebResults:[],setCitedWebResults:()=>{}},FootnoteLink.defaultProps={href:""};var E=n(7907),M=n(66186),F=(0,c.memo)(function(e){let{regenerateAnswer:t,answerIndex:n,requestsLeftForGPT4:r,session:a}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(w.Z,{message:"Regenerate Answer",children:(0,s.jsx)("i",{className:"fe fe-refresh-cw me-4 dropdown dropdown-toggle",style:{cursor:"pointer",fontSize:"16px"},"data-bs-toggle":"dropdown","aria-expanded":"false"})}),(0,s.jsxs)("ul",{className:"dropdown-menu","aria-labelledby":"dropdownMenu2",children:[(0,s.jsx)("h6",{className:"dtopdown-header text-uppercase",children:" Rewrite your answer "}),(0,s.jsx)("li",{children:(0,s.jsx)("button",{className:"dropdown-item",type:"button",onClick:()=>{t(n,"Phind Model")},children:"Use Phind Model"})}),(0,s.jsx)("li",{children:(0,s.jsx)("button",{className:"dropdown-item",type:"button",onClick:()=>{t(n,"GPT-4")},children:"Use GPT-4"})}),(0,s.jsx)("li",{children:(0,s.jsxs)("p",{className:"mt-5 mb-0 fs-6 text-break",children:[(0,s.jsxs)("span",{className:"text-primary",children:[Math.max(r,0)," ","GPT-4 uses left",a&&" today","."]}),(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"text-always-dark",children:"Phind Model has unlimited uses."}),!a&&r<=0&&(0,s.jsx)("button",{className:"btn fs-6 p-0 fw-bold text-always-dark text-decoration-underline",type:"button",onClick:()=>{(0,i.signIn)().then(()=>{v.n.track("Sign In")})},children:"Sign in for more GPT-4 model uses."}),a&&r<=0&&(0,s.jsx)(l(),{className:"btn fs-6 p-0 fw-bold text-always-dark text-decoration-underline",type:"button",href:"/plans",children:"Upgrade for more daily GPT-4 model uses."})]})})]})]})}),_=(0,c.memo)(function(e){var t,n,r,a,l,o,i,u,h,p;let m;let{message:g,index:f,isLast:b,handleUserInput:k,pinnedMessages:y,setPinnedMessages:N,setContinueFromMessageIndex:C,continueFromMessageIndex:S,answerModel:T,requestsLeftForGPT4:A,session:P,regenerateAnswer:I,editAnswer:R}=e,_=!0;((null===(t=g.functionCall)||void 0===t?void 0:t.name)==="START_TASK"||"START_TASK"===g.name||"skip"===g.content)&&(_=!1);let O="function"===g.role&&g.name&&!["SEARCH","ASK_USER","SOLVE","START_TASK"].includes(g.name),[U,G]=(0,c.useState)(!0),[Z,L]=(0,c.useState)(!1),[W,D]=(0,c.useState)(!1),q=0===f&&"user"===g.role&&(null!==(u=null==g?void 0:null===(n=g.content)||void 0===n?void 0:n.length)&&void 0!==u?u:0)>1e3,z=function(e){for(var t,n,s,r=["topLevel"],a=0,push=function(e){return r.push(e)},replace=function(e){return r[r.length-1]=e},setRespawn=function(e){null==t&&(t=a,n=r.length,s=e)},clearRespawn=function(e){e===s&&(t=void 0,n=void 0,s=void 0)},pop=function(){return r.pop()},dontConsumeCharacter=function(){return a--},startAny=function(e){if("0"<=e&&e<="9"){push("number");return}switch(e){case'"':push("string");return;case"-":push("numberNeedsDigit");return;case"t":push("true");return;case"f":push("false");return;case"n":push("null");return;case"[":push("arrayNeedsValue");return;case"{":push("objectNeedsKey");return}},l=e.length;a<l;a++){var o=e[a];switch(r[r.length-1]){case"topLevel":startAny(o);break;case"string":switch(o){case'"':pop();break;case"\\":setRespawn("stringEscape"),push("stringEscaped")}break;case"stringEscaped":"u"===o?push("stringUnicode"):(clearRespawn("stringEscape"),pop());break;case"stringUnicode":a-e.lastIndexOf("u",a)==4&&(clearRespawn("stringEscape"),pop());break;case"number":"."===o?replace("numberNeedsDigit"):"e"===o||"E"===o?replace("numberNeedsExponent"):(o<"0"||o>"9")&&(dontConsumeCharacter(),pop());break;case"numberNeedsDigit":replace("number");break;case"numberNeedsExponent":replace("+"===o||"-"===o?"numberNeedsDigit":"number");break;case"true":case"false":case"null":(o<"a"||o>"z")&&(dontConsumeCharacter(),pop());break;case"arrayNeedsValue":"]"===o?pop():isWhitespace(o)||(clearRespawn("collectionItem"),replace("arrayNeedsComma"),startAny(o));break;case"arrayNeedsComma":"]"===o?pop():","===o&&(setRespawn("collectionItem"),replace("arrayNeedsValue"));break;case"objectNeedsKey":"}"===o?pop():'"'===o&&(setRespawn("collectionItem"),replace("objectNeedsColon"),push("string"));break;case"objectNeedsColon":":"===o&&replace("objectNeedsValue");break;case"objectNeedsValue":isWhitespace(o)||(clearRespawn("collectionItem"),replace("objectNeedsComma"),startAny(o));break;case"objectNeedsComma":"}"===o?pop():","===o&&(setRespawn("collectionItem"),replace("objectNeedsKey"))}}null!=n&&(r.length=n);for(var i=[null!=t?e.slice(0,t):e],finishWord=function(t){return i.push(t.slice(e.length-e.lastIndexOf(t[0])))},c=r.length-1;c>=0;c--)switch(r[c]){case"string":i.push('"');break;case"numberNeedsDigit":case"numberNeedsExponent":i.push("0");break;case"true":finishWord("true");break;case"false":finishWord("false");break;case"null":finishWord("null");break;case"arrayNeedsValue":case"arrayNeedsComma":i.push("]");break;case"objectNeedsKey":case"objectNeedsColon":case"objectNeedsValue":case"objectNeedsComma":i.push("}")}return i.join("")}((null===(r=g.functionCall)||void 0===r?void 0:r.arguments)||""),V=[];try{V=Object.entries(JSON.parse(z))}catch(e){}let K="user"===g.role||"ASK_USER"===g.name?"User":"Phind",[H,B]=(0,c.useState)(!1),[Q,Y]=(0,c.useState)(!1),[J,X]=(0,c.useState)(null),$=(0,s.jsxs)("button",{className:"btn btn-no-border btn-sm ms-n1 mb-3 p-0 lift",onClick:()=>{k("skip")},type:"button",children:[(0,s.jsx)("i",{className:"fe fe-chevrons-right"})," ","Skip"]}),[ee,et]=(0,c.useState)([]);"SEARCH"===g.name&&ee&&ee.length>0&&(m=(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("hr",{className:"separator"}),ee.map((e,t)=>(0,s.jsx)(E.Z,{openLinksInNewTab:!0,index:t,webResult:e,pageIndex:0},"web-result-".concat(e.url)))]},"web-answer-".concat(f)));let en=null!==(h=g.content)&&void 0!==h?h:"",handleClickFeedback=(e,t)=>{J||(v.n.track("Agent Feedback",{helpful:t,message:g}),X(t))},handleClickCopy=()=>{var e,t;navigator.clipboard.writeText(null!==(e=g.content)&&void 0!==e?e:""),Y(!0),v.n.track("Copy Answer",{message:null!==(t=g.content)&&void 0!==t?t:""}),setTimeout(()=>{Y(!1)},2e3)};return(0,s.jsx)("div",{children:_&&(0,s.jsx)(d.W_,{name:"answer-".concat(f),className:"row mt-4 mb-4",children:(0,s.jsx)("div",{className:"col",children:(0,s.jsxs)("div",{onMouseOver:()=>{B(!0)},onFocus:()=>{B(!0)},onMouseOut:()=>{B(!1)},onBlur:()=>{B(!1)},children:[O&&(0,s.jsxs)("div",{className:"position-absolute end-0 top-0 p-1 m-2 fs-6",style:{cursor:"pointer"},onClick:()=>G(e=>!e),children:["VSCode System Output",(0,s.jsx)("i",{className:"fe m-1 ".concat(U?"fe-chevron-down":"fe-chevron-up")})]}),(0,s.jsx)("div",{style:{paddingTop:"0px",paddingLeft:"0px",paddingRight:"0px",paddingBottom:"1px"},children:(!O||!U)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"User"===K?"badge bg-secondary mb-2":"badge bg-primary mb-2",children:K}),(0,s.jsx)("span",{className:"badge bg-primary-soft mb-2 mx-1",children:null===(a=g.functionCall)||void 0===a?void 0:a.name.replace("_"," ")}),"user"===g.role&&(Z?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Z,{placeholder:"Edit your question.",initialQuestionFromCache:null!==(p=g.content)&&void 0!==p?p:"",initialContext:"",defaultNumRowsToShow:2,answerModel:T,customSearchHandler:(e,t)=>{L(!1);let n="".concat(e,"\n").concat(t);R(f,n)}}),(0,s.jsx)("button",{className:"btn btn-no-border lift ms-n2 btn-sm py-0",type:"button",onClick:()=>{L(!1)},children:"Cancel"})]}):(0,s.jsxs)("div",{tabIndex:0,onMouseOver:()=>{D(!0)},onMouseOut:()=>{D(!1)},onFocus:()=>{D(!0)},onBlur:()=>{D(!1)},children:[(0,s.jsx)("span",{className:en.length>2e3?"fs-6 mb-0 font-monospace":"fs-5 mb-0",style:{wordWrap:"break-word",overflowWrap:"break-word"},children:en.split("\n").map((e,t,n)=>(0,s.jsxs)(c.Fragment,{children:[e.replace(/ /g,"\xa0").replace(/\t/g," "),t!==n.length-1&&(0,s.jsx)("br",{})]},"".concat(e)))}),(0,s.jsx)("div",{className:"position-absolute bottom-0",children:(0,s.jsx)("button",{className:"btn btn-no-border lift btn-sm ps-0 pt-1 m-0 border-0",type:"button",style:{display:W?"block":"none"},onClick:()=>{v.n.track("Edit Question",{message:g}),L(!0)},children:"Edit Question"})})]})),"user"!==g.role&&(0,s.jsx)(AnswerMarkdown,{answerText:en,question:"",webResults:(null===(o=g.metadata)||void 0===o?void 0:null===(l=o.webResults)||void 0===l?void 0:l.length)>0?g.metadata.webResults:void 0,citedWebResults:ee,setCitedWebResults:et}),(0,s.jsx)("div",{className:"mb-2",children:V.map(e=>{let[t,n]=e;return"suggested_followup_questions"!==t?(0,s.jsxs)("p",{className:"card-text my-0 fs-5 text-black",children:[(0,s.jsx)("strong",{children:"query"===t||"second_query"===t?(0,s.jsx)("i",{className:"fe fe-search"}):"".concat(t.replaceAll("_"," "),":")})," ","string"==typeof n?n:JSON.stringify(n)]},t):(0,s.jsxs)("p",{className:"card-text mb-4 fs-5 text-black",children:[(0,s.jsxs)("strong",{children:[t.replaceAll("_"," "),":"]}),(0,s.jsx)("br",{}),n.map(e=>(0,s.jsx)("button",{className:"btn btn-light-card btn-sm m-1 text-wrap text-start",type:"button",onClick:()=>{k(e),v.n.track("Suggested Followup Question",{question:e})},children:e},e))]},t)})}),(0,s.jsx)("div",{className:"position-absolute bottom-0",children:H&&"user"!==g.role&&(0,s.jsxs)(s.Fragment,{children:[b&&(0,s.jsx)(F,{regenerateAnswer:I,answerIndex:f,requestsLeftForGPT4:A,session:P}),!1!==J&&(0,s.jsx)(w.Z,{message:"Good Answer",children:(0,s.jsx)("i",{className:"fe fe-thumbs-up ms-0 me-4",style:{cursor:"pointer",fontSize:"16px"},onClick:e=>handleClickFeedback(e,!0)})}),!0!==J&&(0,s.jsx)(w.Z,{message:"Bad Answer",children:(0,s.jsx)("i",{className:"fe fe-thumbs-down ms-0 me-4",style:{cursor:"pointer",fontSize:"16px"},onClick:e=>handleClickFeedback(e,!1)})}),Q?(0,s.jsx)("i",{className:"fe fe-check text-success ms-0 me-4",style:{cursor:"pointer",fontSize:"16px"},onClick:()=>handleClickCopy()}):(0,s.jsx)(w.Z,{message:"Copy Message",children:(0,s.jsx)("i",{className:"fe fe-copy ms-0 me-4",style:{cursor:"pointer",fontSize:"16px"},onClick:()=>handleClickCopy()})}),-1===y.indexOf(f)?(0,s.jsx)(w.Z,{message:"Have the LLM prioritze this message in its answer.",children:(0,s.jsx)("i",{className:"fe fe-star ms-0 me-4",style:{cursor:"pointer",fontSize:"16px"},onClick:()=>{v.n.track("Pin Message",{message:g,index:f}),N(e=>[...e,f])}})}):(0,s.jsx)(w.Z,{message:"Unpin this message.",children:(0,s.jsx)("i",{className:"fe fe-star text-warning ms-0 me-4",style:{cursor:"pointer",fontSize:"16px"},onClick:()=>N(e=>e.filter(e=>e!==f))})}),(0,s.jsx)(w.Z,{message:"Continue from this message",children:S===f?(0,s.jsx)("i",{className:"fe fe-corner-down-left text-primary ms-0 me-4",style:{cursor:"pointer",fontSize:"16px"},onClick:()=>{C(-1)}}):(0,s.jsx)("i",{className:"fe fe-corner-down-left ms-0 me-4",style:{cursor:"pointer",fontSize:"16px"},onClick:()=>{v.n.track("Continue From Message",{message:g,index:f}),C(f)}})})]})}),(null===(i=g.functionCall)||void 0===i?void 0:i.name)==="ASK_USER"&&b&&$,"SEARCH"===g.name&&ee&&ee.length>0&&m,q&&(0,s.jsx)("div",{className:"m-0 p-0",children:(0,s.jsx)(M.m,{url:j.Vt,message:j.yv},j.Vt)})]})}),(0,s.jsx)("div",{className:(g.role,"p-3"),style:{borderRadius:"50%"}})]})})},f)},"div-".concat(g))}),O=n(50897),U=n(92218),G=n(12074);function replaceFunctionCallKey(e){let t={...e};return Object.prototype.hasOwnProperty.call(t,"functionCall")&&(t.function_call=t.functionCall,delete t.functionCall),t}function Agent(e){var t,n;let{cachedMessages:a,numRequestsDone:h,anonUserID:N,phindPlan:C,paidPlanValid:S,chatIsPrivate:T,chatHistoryEnabled:A,renderingAsComponent:P}=e,{isXs:I,isLg:R,isXl:E}=(0,b.k)(),{isSidebarOpen:M}=(0,G.A)(),{data:F}=(0,i.useSession)(),[Z,L]=(0,f.Z)("numNotLoggedInRequestsDone",0),[W,D]=(0,f.Z)("answerModel","Phind Model"),[q,z]=(0,c.useState)(W),[V,K]=(0,c.useState)(!1),[H,B]=(0,c.useState)(!1),Q=(0,c.useRef)((0,m.Mc)()),[Y,J]=(0,c.useState)(!1);(0,c.useEffect)(()=>{J(!0);let handleEsc=e=>{"Escape"===e.key&&handleStopGenerating()};return window.addEventListener("keydown",handleEsc),()=>{window.removeEventListener("keydown",handleEsc)}},[]);let[X,$]=(0,c.useState)([]),ee=100;Y&&(F?ee=(0,k.N7)(C,S)-h:null===F&&(ee=j.BH-Z)),(0,c.useEffect)(()=>{void 0!==W&&(z(W),B(!0))},[W]);let[et,en]=(0,c.useState)(!1),[es,er]=(0,c.useState)(!1),[ea,el]=(0,c.useState)({}),[eo,ei]=(0,c.useState)(-1),ec=(0,k.$j)(ea),ed=[...a,...ec],eu=(0,c.useRef)(new AbortController),{signal:eh}=eu.current,ep=(0,o.useRouter)(),{query:em}=ep,{q:eg,cache:ef,long:eb,home:ex}=em;(0,c.useEffect)(()=>{let routeChangeStart=()=>{Q.current=(0,m.Mc)()};return ep.events.on("routeChangeStart",routeChangeStart),()=>{ep.events.off("routeChangeStart",routeChangeStart)}},[ep]);let ew="Phind Model"===W||"GPT-4"===W&&ee<=0,ej=("Phind Pro"===C||"Phind Pro Yearly"===C)&&S,ev=ej?j.CZ:j.M9,ek=ew?j.c5:ev,ey=eb&&window.localStorage&&!P,eN=ey&&localStorage.getItem("long-question")||"",eC=ey&&localStorage.getItem("long-context")||"",eS=null!=eg?eg:""!==eN.trim()||""!==eC.trim()?"".concat(eN,"\n").concat(eC):"",eT=null!=ef?ef:"",eA=eS||ed.length>0?ed:[{role:"assistant",content:"Hello! Ask me a question to get started.\n      I can work with you to solve problems, brainstorm ideas, and more.\n      I am also able to browse the internet."}],eP=eA.filter(e=>"assistant"!==e.role).length;(0,c.useEffect)(()=>{if(!ex&&Y&&(F||null===F)&&0===ed.length){var e,t;F||L(e=>e+1),getAgentResponse(eS,ed,eT),(null==F?void 0:null===(e=F.user)||void 0===e?void 0:e.userId)&&v.n.identify(null==F?void 0:null===(t=F.user)||void 0===t?void 0:t.userId)}},[eS,ep,Y,F]);let handleStopGenerating=()=>{v.n.track("Agent Stop Generating"),eu.current.abort(),eu.current=new AbortController,er(!1)},getAgentResponse=async(e,t,n,s)=>{var a,l;if(!e.trim()||es)return;let o=Q.current,i=null!=q?q:j.Wg,c=null!==(l=null!=s?s:q)&&void 0!==l?l:j.Wg,d=e;(0,k.In)(e,c)>ek&&(d=(0,k.yF)(e,ek,c)),er(!0),K(!1);let h=[...t];-1!==eo&&(h=h.slice(0,eo+1));let p={role:"user",content:d},m={id:"user.message.".concat(h.length),created:Math.floor(Date.now()/1e3),choices:[{delta:p}]};el(e=>(0,k.Ih)(e,m)),h.push(p);let g=function(e,t){let n=[...e];return t&&t.forEach(e=>{n[e].metadata={...n[e].metadata,pinned:!0}}),n.map(replaceFunctionCallKey)}(h,X);(0,y.uE)(d,g,c,N,null==F?void 0:null===(a=F.user)||void 0===a?void 0:a.userId).then(async e=>{let s=(0,k.Ih)({},m),r=(0,u.j)(e=>{if(o!==Q.current){console.warn("Thread UUID changed, ignoring event.");return}if("event"===e.type){let t;if((null==e?void 0:e.event)==="error"){K(!0);return}let{data:n}=e;try{if(t=JSON.parse(n),"metadata"===t.type){let e="gpt-4"===t.model?"GPT-4":"Phind Model";z(e),D(e),"Phind Model"===e&&"GPT-4"===W&&0===ee&&en(!0)}}catch(e){console.error(e),K(!0);return}t.id&&(s=(0,k.Ih)(s,t),el(e=>(0,k.Ih)(e,t)))}}),a=e.body,l=(0,k.Mz)(a,eh);for await(let e of(0,k.Uj)(l)){let t=new TextDecoder().decode(e);r.feed(t)}if(o!==Q.current){console.warn("Thread UUID changed, ignoring event.");return}W&&(D(i),z(i));let c=(0,k.$j)(s);await saveChatToDb(t,c,d,n,o),er(!1)}).catch(e=>{console.error(e),r.Tb(e),K(!0),er(!1)})},regenerateAnswer=async(e,t)=>{let n=ed[e-1].content;ed.splice(e-1,2),a.splice(e-1,2);let s=Object.keys(ea);s.sort((e,t)=>ea[e].created-ea[t].created);let r=s[s.length-1],l=s[s.length-2];delete ea[r],delete ea[l],await(0,y.l6)(eT,e-1,2),n&&getAgentResponse(n,ed,eT,t)},editAnswer=async(e,t)=>{a.splice(e,a.length-e);let n=ed.length-e,s=Object.keys(ea);s.sort((e,t)=>ea[e].created-ea[t].created);for(let e=0;e<n;e+=1){let t=s[s.length-1-e];delete ea[t]}ed.splice(e,ed.length-e),await(0,y.l6)(eT,e,n),t&&getAgentResponse(t,ed,eT)};(0,c.useEffect)(()=>{d.OK.scrollTo("answer-".concat(eA.length-1),{duration:650,delay:0,smooth:"easeInOutQuart"})},[eA.length]);let handleUserInput=async(e,t)=>{F||L(e=>e+1);let n=t?"".concat(e,"\n").concat(t):e;es||await getAgentResponse(n,ed,eT)};if(!Y)return null;return(0,s.jsxs)(s.Fragment,{children:[!!(null==ed?void 0:ed.length)&&(0,s.jsx)(p(),{children:(0,s.jsx)("title",{children:"Phind - ".concat(ed[0].content)})}),(0,s.jsx)("div",{className:"col-12",children:(0,s.jsx)("div",{className:"row",children:(0,s.jsxs)("div",{className:"col-12",children:[(0,s.jsx)(O.Z,{show:et,setShow:en}),(0,s.jsxs)("div",{className:I?"container-xl p-3":"container-xl",children:[!R&&!E&&(0,s.jsx)("div",{children:(0,s.jsxs)("button",{type:"button",className:"btn btn-no-border p-0 ms-n2 lift btn-sm my-2",onClick:()=>{window.location.href="/"},children:[(0,s.jsx)("i",{className:"mx-2 fe fe-message-square"}),"New Thread"]})}),Y&&(0,s.jsx)(w.Z,{message:"Select your preferred answering model.",children:(0,s.jsx)(U.Z,{answerModel:null!==(t=null!=q?q:W)&&void 0!==t?t:j.Wg,setAnswerModel:e=>{ee<=0&&"GPT-4"===e?en(!0):D(e)},requestsLeftForGPT4:ee,session:F})}),H&&W&&"GPT-4"===W&&"GPT-4"!==q&&(0,s.jsx)("div",{children:F?(0,s.jsx)(w.Z,{message:"You get 10 GPT-4 uses each day. Upgrade for higher limits. You have unlimited Phind Model uses after your GPT-4 uses expire.",placement:"bottom",children:(0,s.jsx)(l(),{className:"btn fs-6 fw-bold text-dark text-decoration-underline",href:"/plans",children:"Upgrade for more daily GPT-4 uses"})}):(0,s.jsx)("button",{className:I?"btn p-0 fs-6 fw-bold text-dark text-decoration-underline":"btn fs-6 fw-bold text-dark text-decoration-underline",type:"button",onClick:()=>{(0,i.signIn)().then(()=>{v.n.track("Sign In")})},children:"Sign in for more GPT-4 uses"})}),(0,s.jsx)("div",{children:F&&(0,s.jsxs)("span",{className:"fs-6 fw-bold me-2 ms-0",children:[T?"Private":"Shareable"," ",(0,s.jsx)(w.Z,{message:"This thread is ".concat(T?"private":"shareable","."),children:(0,s.jsx)("i",{className:"fe ".concat(T?"fe-lock":"fe-unlock"," m-1"),style:{cursor:"pointer"},onClick:()=>{!es&&window.confirm("Make this chat ".concat(T?"shareable":"private","?"))&&(v.n.track("Toggle Chat Privacy",{newPrivateValue:!T}),(0,y.Q2)(eT,!T).then(()=>{ep.reload()}))}})})]})}),(0,s.jsx)("div",{className:"mt-8",children:eA.map((e,t)=>{var n;return(0,s.jsx)(_,{message:e,index:t,isLast:t===eA.length-1,handleUserInput:handleUserInput,pinnedMessages:X,setPinnedMessages:$,continueFromMessageIndex:eo,setContinueFromMessageIndex:ei,answerModel:null!==(n=null!=q?q:W)&&void 0!==n?n:j.Wg,requestsLeftForGPT4:ee,session:F,regenerateAnswer:regenerateAnswer,editAnswer:editAnswer},"message-".concat(t))})}),V&&(0,s.jsx)("div",{className:"text-center",children:(0,s.jsxs)("button",{className:"btn btn-primary btn-sm",onClick:()=>{getAgentResponse("continue",ed,eT),K(!1)},type:"button",children:[(0,s.jsx)("i",{className:"mx-2 fe fe-refresh-cw"}),"Continue"]})}),(0,s.jsx)("div",{className:"mb-12",style:{minHeight:"30px"}}),(0,s.jsx)("div",{className:"mt-10"}),eA.length<=j.Ni?(0,s.jsx)("div",{className:"fixed-bottom bg-gradient-light",style:{pointerEvents:"none"},children:(0,s.jsx)(g.E.div,{initial:{opacity:0,translateY:0,scale:1},animate:{opacity:1,translateY:0,scale:1},transition:{duration:.3},children:(0,s.jsxs)("div",{className:"row",children:[(0,s.jsx)("div",{className:M?"col-2":"col-0"}),(0,s.jsx)("div",{className:M?"col-10":"col-12",style:{pointerEvents:"auto"},children:(0,s.jsxs)("div",{className:I?"container-xl p-3":"container-xl",children:[es&&(0,s.jsxs)("button",{className:"btn btn-no-border ms-n2 m-0 pb-3 ps-0 btn-sm lift",style:{position:"relative",right:0,top:0},onClick:handleStopGenerating,type:"button",children:[(0,s.jsx)("i",{className:"fe fe-stop-circle m-2"}),"Stop [Esc]"]}),(0,s.jsx)(x.Z,{placeholder:-1!==eo?"Continue from message ".concat(eo+1):"Send message",initialQuestionFromCache:"",initialContext:"",defaultNumRowsToShow:1,loading:es,customSearchHandler:handleUserInput,answerModel:null!==(n=null!=q?q:W)&&void 0!==n?n:j.Wg,maxTokenLimit:ev},eP)]})})]})})}):(0,s.jsxs)("div",{className:"container justify-center mb-10",children:[(0,s.jsx)("h3",{children:"Task Message Limit Reached - context is better when a task is dedicated to one thing. You can export the last few messages to a new task."}),(0,s.jsxs)("button",{className:"btn btn-primary btn-sm",style:{position:"relative",right:0,top:0},onClick:()=>handleExportChat(ed,eT),type:"button",children:[(0,s.jsx)("i",{className:"fe fe-share m-2"}),"Export To New Chat"]})]})]})]})})})]});async function handleExportChat(e,t){let n="https://www.phind.com/agent?cache=".concat(t),s=e.slice(-5);await(0,y.ou)("Exported Chat",s).then(e=>e.json()).then(e=>{let{id:s}=e;v.n.track("Export Chat",{cacheId:t,cacheUrl:n}),ep.push({pathname:"/agent",query:{cache:s}},void 0,{shallow:!1})})}async function saveChatToDb(e,t,n,s,r){let a="https://www.phind.com/agent?cache=".concat(s);if(t.length<=0)return;let l={userInput:n,userInputLength:n.length,messageInput:e,newMessages:t,cacheUrl:a,cacheId:s,chatLength:e.length+t.length,options:{model:q}};A&&r===Q.current&&(s?await(0,y.T6)(s,t):await(0,y.ou)(n,t).then(e=>e.json()).then(e=>{let{id:t}=e;l.cacheId=t;let n="https://www.phind.com/agent?cache=".concat(t);l.cacheUrl=n,ep.push({pathname:"/agent",query:{cache:t}},void 0,{shallow:!0})})),v.n.track("Agent turn",l)}}Agent.defaultProps={anonUserID:"",phindPlan:"Phind Free",paidPlanValid:!1,renderingAsComponent:!1};var Z=!0,L=Agent}},function(e){e.O(0,[74,507,805,774,888,179],function(){return e(e.s=58362)}),_N_E=e.O()}]);